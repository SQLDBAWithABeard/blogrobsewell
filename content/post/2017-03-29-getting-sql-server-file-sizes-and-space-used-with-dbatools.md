---
title: "Getting SQL Server File Sizes and Space Used with dbatools"
categories:
  - Blog

tags:
  - automate
  - automation
  - dbatools
  - files
  - PowerShell

---
<P>I read a great blog post about answering the question <A href="https://sqlbuffet.wordpress.com/2017/03/08/how-big-is-the-database-how-to-answer-that-annoying-question/" target=_blank>how big is the database using T-SQL on SQL Buffet</A> and wondered how much I could do with the <A href="https://dbatools.io" target=_blank>dbatools module</A></P>
<P>The dbatools module (for those that don’t know) is a PowerShell module written by amazing folks in the community designed to make administrating your SQL Server significantly easier using PowerShell. The instructions for installing it are <A href="https://dbatools.io/getting-started/" target=_blank>available here</A> It comprises of 182 separate commands at present (11 March 2017 Version 0.8.938)</P>
<P>I know that there is a <A href="https://dbatools.io/functions/get-dbadatabasefreespace/" target=_blank>Get-DBADatabaseFreeSpace Command</A> written by Mike Fal <A href="http://mikefal.net" target=_blank>b</A> | <A href="https://twitter.com/mike_fal" target=_blank>t</A>&nbsp;and using <A href="http://www.sqlskills.com/blogs/glenn/category/dmv-queries/)" target=_blank>Glenn Berry’s diagnostic queries</A></P>
<P>First thing as always is to look at the help</P><PRE class="lang:ps decode:true"> Get-Help Get-DbaDatabaseFreespace -ShowWindow</PRE>
<P>which will show you the help for the command and some examples</P>
<P>Lets look at the details for a single instance</P><PRE class="lang:ps decode:true"> Get-DbaDatabaseFreespace -sqlserver $server</PRE>
<P>This is what it looks like</P>
<P><IMG class="alignnone size-full wp-image-3634" alt="02 - singel server.gif" src="https://blog.robsewell.com/assets/uploads/2017/03/02-singel-server.gif?resize=630%2C220&amp;ssl=1" width=630 height=220 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/02-singel-server.gif?fit=630%2C220&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/02-singel-server.gif?fit=300%2C105&amp;ssl=1" data-image-description="" data-image-title="02 – singel server" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1832,640" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/02-singel-server.gif?fit=1832%2C640&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/02-singel-server/#main" data-attachment-id="3634"></P>
<P>and yes it really is that fast, I have not speeded this up. 232 ms to get those details for an instance with 19 databases</P>
<P><IMG class="alignnone size-full wp-image-3636" alt="03 - Measure Command.PNG" src="https://blog.robsewell.com/assets/uploads/2017/03/03-measure-command.png?resize=630%2C310&amp;ssl=1" width=630 height=310 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/03-measure-command.png?fit=630%2C310&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/03-measure-command.png?fit=300%2C148&amp;ssl=1" data-image-description="" data-image-title="03 – Measure Command" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="866,426" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/03-measure-command.png?fit=866%2C426&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/03-measure-command/#main" data-attachment-id="3636"></P>
<P>What information do you get ? Lets look at the information for a single database, you get an object for each file</P>
<DIV>
<DIV></DIV>
<DIV>Server&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : SQL2014SER12R2<BR>Database&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DBA-Admin<BR>FileName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DBA-Admin_System<BR>FileGroup&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : PRIMARY<BR>PhysicalName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : F:\DBA-Admin_System.MDF<BR>FileType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : ROWS<BR>UsedSpaceMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 3<BR>FreeSpaceMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 253<BR>FileSizeMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 256<BR>PercentUsed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 1<BR>AutoGrowth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0<BR>AutoGrowType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : MB<BR>SpaceUntilMaxSizeMB&nbsp; : 16777213<BR>AutoGrowthPossibleMB : 0<BR>UnusableSpaceMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 16777213</DIV>
<DIV></DIV>
<DIV>Server&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : SQL2014SER12R2<BR>Database&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DBA-Admin<BR>FileName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DBA-Admin_Log<BR>FileGroup&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :<BR>PhysicalName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : G:\DBA-Admin_Log.LDF<BR>FileType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : LOG<BR>UsedSpaceMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 32<BR>FreeSpaceMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 224<BR>FileSizeMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 256<BR>PercentUsed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 12<BR>AutoGrowth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 256<BR>AutoGrowType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : MB<BR>SpaceUntilMaxSizeMB&nbsp; : 2528<BR>AutoGrowthPossibleMB : 2304<BR>UnusableSpaceMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0</DIV>
<DIV></DIV>
<DIV>Server&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : SQL2014SER12R2<BR>Database&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DBA-Admin<BR>FileName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DBA-Admin_User<BR>FileGroup&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : UserFG<BR>PhysicalName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : F:\DBA-Admin_User.NDF<BR>FileType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : ROWS<BR>UsedSpaceMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 1<BR>FreeSpaceMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 255<BR>FileSizeMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 256<BR>PercentUsed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0<BR>AutoGrowth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 256<BR>AutoGrowType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : MB<BR>SpaceUntilMaxSizeMB&nbsp; : 5119<BR>AutoGrowthPossibleMB : 4864<BR>UnusableSpaceMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 0</DIV>
<DIV></DIV></DIV>
<DIV></DIV>
<DIV>There is a lot of useful information&nbsp;returned for each file. Its better if you use Out-GridView as then you can order by columns and filter in the top bar.</DIV>
<DIV></DIV>
<DIV><IMG class="alignnone size-full wp-image-3646" alt="04 - single server ogv.gif" src="https://blog.robsewell.com/assets/uploads/2017/03/04-single-server-ogv.gif?resize=630%2C317&amp;ssl=1" width=630 height=317 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/04-single-server-ogv.gif?fit=630%2C317&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/04-single-server-ogv.gif?fit=300%2C151&amp;ssl=1" data-image-description="" data-image-title="04 – single server ogv" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1652,832" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/04-single-server-ogv.gif?fit=1652%2C832&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/04-single-server-ogv/#main" data-attachment-id="3646"></DIV>
<P>&nbsp;</P>
<P>As always, PowerShell uses the permissions of the account running the sessions to connect to the SQL Server unless you provide a separate credential for SQL Authentication. If you need to connect with a different windows account you will need to hold Shift down and right click on the PowerShell icon and click run as a different user.</P>
<P>Lets get the information for a single database. The command has dynamic parameters which populate the database names to save you time and keystrokes</P>
<P><IMG class="alignnone size-full wp-image-3651" alt="05 dynamic parameters.gif" src="https://blog.robsewell.com/assets/uploads/2017/03/05-dynamic-parameters.gif?resize=630%2C300&amp;ssl=1" width=630 height=300 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/05-dynamic-parameters.gif?fit=630%2C300&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/05-dynamic-parameters.gif?fit=300%2C143&amp;ssl=1" data-image-description="" data-image-title="05 dynamic parameters" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1710,814" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/05-dynamic-parameters.gif?fit=1710%2C814&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/05-dynamic-parameters/#main" data-attachment-id="3651"></P>
<P>But you may want to gather information about more than one server. lets take a list of servers and place them into a variable. You can add your servers to this variable in a number of ways, maybe by querying your CMDB or using your registered servers or central management server</P><PRE class="lang:ps decode:true">$SQLServers = 'SQL2005Ser2003','SQL2012Ser08AG3','SQL2012Ser08AG1','SQL2012Ser08AG2','SQL2014Ser12R2','SQL2016N1','SQL2016N2','SQL2016N3','SQLVnextN1','SQLvNextN2'
</PRE>
<P>and then</P><PRE class="lang:ps decode:true">Get-DbaDatabaseFreespace -SqlInstance $SQLServers | Out-GridView</PRE>
<P>&nbsp;</P>
<P><IMG class="alignnone size-full wp-image-3660" alt="06 - Many servers ogv.PNG" src="https://blog.robsewell.com/assets/uploads/2017/03/06-many-servers-ogv.png?resize=630%2C340&amp;ssl=1" width=630 height=340 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/06-many-servers-ogv.png?fit=630%2C340&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/06-many-servers-ogv.png?fit=300%2C162&amp;ssl=1" data-image-description="" data-image-title="06 – Many servers ogv" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1783,963" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/06-many-servers-ogv.png?fit=1783%2C963&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/06-many-servers-ogv/#main" data-attachment-id="3660"></P>
<P>As you can see, you get a warning quite correctly, that the information for the asynchronous secondary node of the availability group databases is not available and I did not have all of my servers running so there are a couple of could not connect warnings as well. You can still filter very quickly. dbatools is tested from SQL2000 to SQL vNext as you can see below&nbsp;(although I don’t have a SQL2000 instance)</P>
<P><IMG class="alignnone size-full wp-image-3666" alt="07 - filter ogv" src="https://blog.robsewell.com/assets/uploads/2017/03/07-filter-ogv.png?resize=630%2C417&amp;ssl=1" width=630 height=417 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/07-filter-ogv.png?fit=630%2C417&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/07-filter-ogv.png?fit=300%2C198&amp;ssl=1" data-image-description="" data-image-title="07 – filter ogv" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1418,938" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/07-filter-ogv.png?fit=1418%2C938&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/07-filter-ogv/#main" data-attachment-id="3666"></P>
<P>&nbsp;</P>
<P>Not only on Windows, this command will work&nbsp;against SQL running on Linux as well</P>
<P><IMG class="alignnone size-full wp-image-3670" alt="08 - linux.PNG" src="https://blog.robsewell.com/assets/uploads/2017/03/08-linux.png?resize=630%2C289&amp;ssl=1" width=630 height=289 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/08-linux.png?fit=630%2C289&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/08-linux.png?fit=300%2C137&amp;ssl=1" data-image-description="" data-image-title="08 – linux" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1749,801" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/08-linux.png?fit=1749%2C801&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/08-linux/#main" data-attachment-id="3670"></P>
<P>So if we want to know the total size of the&nbsp;files on disk for&nbsp; the database we need to look at the FileSizeMB property</P><PRE class="lang:ps decode:true">$server = 'SQL2014Ser12R2'
$dbName = 'AdventureWorksDW2014'
Get-DbaDatabaseFreespace -SqlServer $server -database $dbName |
Select Database,FileName,FileSizeMB</PRE>
<P>Of course that’s an easy calculation here</P>
<P><IMG class="alignnone size-full wp-image-3690" alt="08a - filesize.PNG" src="https://blog.robsewell.com/assets/uploads/2017/03/08a-filesize.png?resize=630%2C190&amp;ssl=1" width=630 height=190 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/08a-filesize.png?fit=630%2C190&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/08a-filesize.png?fit=300%2C90&amp;ssl=1" data-image-description="" data-image-title="08a – filesize" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1040,313" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/08a-filesize.png?fit=1040%2C313&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/08a-filesize/#main" data-attachment-id="3690"></P>
<P>but if we have numerous files then it may be tougher. we can use the Measure-Object command to sum the properties. We need to do a bit of preparation here and set a couple of calculated properties to make it more readable</P><PRE class="lang:ps decode:true">$server = 'SQL2014Ser12R2'
$dbName = 'AdventureWorksDW2014'
$database = @{Name = 'Database'; Expression = {$dbname}}
$FileSize = @{Name = 'FileSize'; Expression = {$_.Sum}}
Get-DbaDatabaseFreespace -SqlServer $server -database $dbName |
Select Database,FileSizeMB |
Measure-Object FileSizeMB -Sum |
Select $database ,Property, $filesize</PRE>
<P><IMG class="alignnone size-full wp-image-3683" alt="09 - filessize" src="https://blog.robsewell.com/assets/uploads/2017/03/09-filessize.png?resize=630%2C225&amp;ssl=1" width=630 height=225 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/09-filessize.png?fit=630%2C225&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/09-filessize.png?fit=300%2C107&amp;ssl=1" data-image-description="" data-image-title="09 – filessize" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1049,374" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/09-filessize.png?fit=1049%2C374&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/09-filessize/#main" data-attachment-id="3683"></P>
<P>Maybe we want to look at all of the databases on an instance. Again, we have to do&nbsp;a little more work here</P><PRE class="lang:ps decode:true">$server = 'SQL2014Ser12R2'
$srv = Connect-DbaSqlServer $server
$SizeonDisk = @()
$srv.Databases |ForEach-Object {
$dbName = $_.Name
$database = @{Name = 'Database'; Expression = {$dbname}}
$FileSize = @{Name = 'FileSize'; Expression = {$_.Sum}}
$SizeOnDisk += Get-DbaDatabaseFreespace -SqlServer $server -database $dbName | Select Database,FileSizeMB |&nbsp; Measure-Object FileSizeMb -Sum | Select $database ,Property, $Filesize
}
$SizeOnDisk</PRE>
<P><IMG class="alignnone size-full wp-image-3694" alt="10 - size on disk" src="https://blog.robsewell.com/assets/uploads/2017/03/10-size-on-disk.png?resize=630%2C438&amp;ssl=1" width=630 height=438 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/10-size-on-disk.png?fit=630%2C438&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/10-size-on-disk.png?fit=300%2C209&amp;ssl=1" data-image-description="" data-image-title="10 – size on disk" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="853,593" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/10-size-on-disk.png?fit=853%2C593&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/10-size-on-disk/#main" data-attachment-id="3694"></P>
<P>If we wanted the databases ordered by the size of their files we could do this</P><PRE class="lang:ps decode:true">$SizeOnDisk |Sort-Object Filesize -Descending</PRE>
<P><IMG class="alignnone size-full wp-image-3700" alt="11 - size sorted.PNG" src="https://blog.robsewell.com/assets/uploads/2017/03/11-size-sorted.png?resize=630%2C345&amp;ssl=1" width=630 height=345 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/11-size-sorted.png?fit=630%2C345&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/11-size-sorted.png?fit=300%2C164&amp;ssl=1" data-image-description="" data-image-title="11 – size sorted" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1044,571" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/11-size-sorted.png?fit=1044%2C571&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/11-size-sorted/#main" data-attachment-id="3700"></P>
<P>As it is PowerShell we have an object and we can use it any way we like. Maybe we want that information in a text file or a csv or an excel file or in an email, PowerShell can do that</P><PRE class="lang:ps decode:true"> ## In a text file
$SizeonDisk | Out-file C:\temp\Sizeondisk.txt
Invoke-Item C:\temp\Sizeondisk.txt
## In a CSV
$SizeonDisk | Export-Csv C:\temp\Sizeondisk.csv -NoTypeInformation
notepad C:\temp\Sizeondisk.csv
## Email
Send-MailMessage -SmtpServer $smtp -From DBATeam@TheBeard.local -To JuniorDBA-Smurf@TheBeard.Local `
-Subject "Smurf this needs looking At" -Body $SizeonDisk
## Email as Attachment
Send-MailMessage -SmtpServer $smtp -From DBATeam@TheBeard.local -To JuniorDBA-Smurf@TheBeard.Local `
-Subject "Smurf this needs looking At" -Body "Smurf" -Attachments C:\temp\Sizeondisk.csv</PRE>
<P>I had a little play with <A href="https://github.com/proxb/PoshCharts/tree/Dev" target=_blank>Boe Prox PoshCharts</A> (you have to use the dev branch) to see if I could get some nice charts and unfortunately the bar charts did not come out so well but luckily the donut and pie charts did. (I’m a DBA I love donuts!)</P><PRE class="lang:ps decode:true">$SizeonDisk| Out-PieChart -XField Database -YField FileSize -Title "UsedSpaceMB per Database on $Server" -IncludeLegend -Enable3D
$SizeonDisk| Out-DoughnutChart -XField Database -YField FileSize -Title "UsedSpaceMB per Database on $Server" -IncludeLegend -Enable3D</PRE>
<P><IMG class="alignnone size-full wp-image-3715" alt="12 - donuts.PNG" src="https://blog.robsewell.com/assets/uploads/2017/03/12-donuts.png?resize=630%2C280&amp;ssl=1" width=630 height=280 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/12-donuts.png?fit=630%2C280&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/12-donuts.png?fit=300%2C134&amp;ssl=1" data-image-description="" data-image-title="12 – donuts" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1856,826" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/12-donuts.png?fit=1856%2C826&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/12-donuts/#main" data-attachment-id="3715"></P>
<P>So the point is, whatever you or your process requires you can pretty much bet that PowerShell can enable it for you to automate.</P>
<P>You can make use of all of the properties exposed by the command. If you want to only see the files with less than 20% space free</P><PRE class="lang:ps decode:true"> Get-DbaDatabaseFreespace -SqlServer $server | Where-Object {$_.PercentUsed -gt 80}</PRE>
<P><IMG class="alignnone size-full wp-image-3721" alt="13 - percent used.PNG" src="https://blog.robsewell.com/assets/uploads/2017/03/13-percent-used.png?resize=630%2C208&amp;ssl=1" width=630 height=208 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/13-percent-used.png?fit=630%2C208&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/13-percent-used.png?fit=300%2C99&amp;ssl=1" data-image-description="" data-image-title="13 – percent used" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1623,535" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/13-percent-used.png?fit=1623%2C535&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/13-percent-used/#main" data-attachment-id="3721"></P>
<P>you can also use the command to check for file growth settings as well</P><PRE class="lang:ps decode:true"> Get-DbaDatabaseFreespace -SqlServer $server | Where-Object {$_.AutoGrowType&nbsp; -ne 'Mb'}</PRE>
<P><IMG class="alignnone size-full wp-image-3724" alt="14 - autogrowth.PNG" src="https://blog.robsewell.com/assets/uploads/2017/03/14-autogrowth.png?resize=630%2C196&amp;ssl=1" width=630 height=196 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/14-autogrowth.png?fit=630%2C196&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/14-autogrowth.png?fit=300%2C93&amp;ssl=1" data-image-description="" data-image-title="14 – autogrowth" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="1710,531" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/14-autogrowth.png?fit=1710%2C531&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/14-autogrowth/#main" data-attachment-id="3724"></P>
<P>Or maybe you want to know the FileSize, Used and Free Space per database</P><PRE class="lang:ps decode:true"> $server = 'SQL2014Ser12R2'
$srv = Connect-DbaSqlServer $server
$SizeonDisk = @()
$srv.Databases |ForEach-Object {
$dbName = $_.Name
$database = @{Name = 'Database'; Expression = {$dbname}}
$MB = @{Name = 'Mbs'; Expression = {$_.Sum}}
$SizeOnDisk += Get-DbaDatabaseFreespace -SqlServer $server -database $dbName | Select Database,FileSizeMB, UsedSpaceMB, FreeSpaceMb |&nbsp; Measure-Object FileSizeMb , UsedSpaceMB, FreeSpaceMb -Sum&nbsp; | Select $database ,Property, $Mb
}
$SizeOnDisk </PRE>
<P><IMG class="alignnone size-full wp-image-3746" alt="15 totals.PNG" src="https://blog.robsewell.com/assets/uploads/2017/03/15-totals.png?resize=630%2C504&amp;ssl=1" width=630 height=504 data-recalc-dims="1" loading="lazy" data-large-file="https://blog.robsewell.com/assets/uploads/2017/03/15-totals.png?fit=630%2C504&amp;ssl=1" data-medium-file="https://blog.robsewell.com/assets/uploads/2017/03/15-totals.png?fit=300%2C240&amp;ssl=1" data-image-description="" data-image-title="15 totals" data-image-meta='{"aperture":"0","credit":"","camera":"","caption":"","created_timestamp":"0","copyright":"","focal_length":"0","iso":"0","shutter_speed":"0","title":"","orientation":"0"}' data-comments-opened="1" data-orig-size="858,686" data-orig-file="https://blog.robsewell.com/assets/uploads/2017/03/15-totals.png?fit=858%2C686&amp;ssl=1" data-permalink="https://blog.robsewell.com/getting-sql-server-file-sizes-and-space-used-with-dbatools/15-totals/#main" data-attachment-id="3746"></P>
<P>Hopefully that has given you a quick insight into another one of the fabulous dbatools commands. Any questions, comment below or head over to the SQL Server Community Slack via <A href="https://sqlps.io/slack" target=_blank>https://sqlps.io/slack</A></P>
<P>Happy Automating</P>
<P>&nbsp;</P>
<P>NOTE – The major 1.0 release of dbatools due in the summer 2017 may have breaking changes which will stop the above code from working. There are also new commands coming which may replace this command. This blog post was written using dbatools version 0.8.942 You can check your version using</P><PRE class="lang:ps decode:true"> Get-Module dbatools</PRE>
<P>and update it using an Administrator PowerShell session with</P><PRE class="lang:ps decode:true"> Update-Module dbatools</PRE>
<P>You may find that you get no output from Update-Module as you have the latest version. If&nbsp;you have not installed the&nbsp;module from the PowerShell Gallery using</P><PRE class="lang:ps decode:true">&nbsp;Install-Module dbatools</PRE>
<P>Then you can use</P><PRE class="lang:ps decode:true">&nbsp;Update-dbatools</PRE>
<P>&nbsp;</P>

